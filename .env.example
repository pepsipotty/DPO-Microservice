# DPO Microservice Environment Configuration
# Copy this file to .env and configure values for your deployment

# ============================================================================
# GATEWAY INTEGRATION (Required for production)
# ============================================================================

# The public URL where this service can be reached (e.g., RunPod proxy URL)
# Required for service registration with the gateway
DPO_PUBLIC_BASE_URL=https://your-runpod-id-8000.proxy.runpod.net

# Gateway registration endpoint
DPO_REGISTER_URL=https://your-gateway-domain.com/api/dpo/register

# Secret for registering/unregistering with the gateway
DPO_REGISTER_SECRET=your_registration_secret_here

# HMAC secret for verifying gateway-signed requests (REQUIRED)
# The gateway signs user claims and forwards them via X-Novalto-User header.
# Admin privileges (admin:true) are required for trigger-finetune endpoint.
# The gateway determines admin status via allowlist OR Firebase custom claims.
DPO_GATEWAY_SHARED_SECRET=your_hmac_secret_here

# Service registration TTL in seconds (default: 21600 = 6 hours)
DPO_SERVICE_TTL_SECONDS=21600

# ============================================================================
# SERVICE CONFIGURATION
# ============================================================================

# Maximum number of concurrent training jobs (default: 2)
DPO_MAX_CONCURRENT_JOBS=2

# Job timeout in seconds (default: 3600 = 1 hour)
DPO_JOB_TIMEOUT_SECONDS=3600

# Maximum dataset size in MB (default: 5)
DPO_MAX_DATASET_SIZE_MB=5

# Rate limit per user per minute (default: 5)
DPO_RATE_LIMIT_PER_MINUTE=5

# Working directory (default: /app)
DPO_WORKING_DIR=/app

# Cache directory for training artifacts (default: /app/.cache)
DPO_CACHE_DIR=/app/.cache

# ============================================================================
# CORS CONFIGURATION (Development only)
# ============================================================================

# Comma-separated list of origins allowed for direct access (development only)
# Leave empty in production - all requests should come through the gateway
# DPO_ALLOW_DIRECT_ORIGINS=http://localhost:3000,http://localhost:8080

# ============================================================================
# TRAINING CONFIGURATION
# ============================================================================

# Disable Weights & Biases logging (recommended for production)
WANDB_DISABLED=true

# Python path
PYTHONPATH=/app

# ============================================================================
# DEPLOYMENT EXAMPLES
# ============================================================================

# Example 1: Local development with direct access
# DPO_GATEWAY_SHARED_SECRET=dev_secret_123
# DPO_ALLOW_DIRECT_ORIGINS=http://localhost:3000
# DPO_MAX_CONCURRENT_JOBS=1

# Example 2: Production RunPod deployment
# DPO_PUBLIC_BASE_URL=https://abc123-8000.proxy.runpod.net
# DPO_REGISTER_URL=https://your-domain.com/api/dpo/register  
# DPO_REGISTER_SECRET=prod_registration_secret_xyz
# DPO_GATEWAY_SHARED_SECRET=prod_hmac_secret_abc
# DPO_MAX_CONCURRENT_JOBS=2

# Example 3: High-performance deployment
# DPO_MAX_CONCURRENT_JOBS=4
# DPO_MAX_DATASET_SIZE_MB=50
# DPO_JOB_TIMEOUT_SECONDS=7200